---
- name: install dependencies
  apt:
    name: ['git', 'libace-dev', 'build-essential',
           'libmysql++-dev', 'libtool', 'libssl-dev', 'zlibc',
           'libc6', 'libbz2-dev', 'cmake', 'libboost-all-dev',
           'unzip']

- name: server directory
  file:
    path: "/home/ubuntu/cmangos-classic"
    owner: "ubuntu"
    mode: 0755
    state: directory

- name: clone servercode
  remote_user: ubuntu
  git:
    repo: "git://github.com/cmangos/mangos-classic.git"
    dest: "/home/ubuntu/cmangos-classic/source"
    version: "master"
    update: yes

- name: build directory
  file:
    path: "/home/ubuntu/cmangos-classic/source/build"
    owner: "ubuntu"
    state: directory

- name: run directory
  file:
    path: "/home/ubuntu/cmangos-classic/run"
    owner: "ubuntu"
    state: directory

- name: build cmangos
  shell: >
    cmake "/home/ubuntu/cmangos-classic/source"
    -DBUILD_EXTRACTORS=1
    -DCMAKE_INSTALL_PREFIX=/home/ubuntu/cmangos-classic/run
    ;
    make -j4
    ;
    make install
  args:
    chdir: "/home/ubuntu/cmangos-classic/source/build"
